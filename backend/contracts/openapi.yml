openapi: 3.0.3
info:
  title: Food Commerce API
  description: API First contract for modular monolithic food e-commerce
  version: 1.0.0

servers:
  - url: http://localhost:3000

tags:
  - name: Catalog
  - name: Products
  - name: Inventory
  - name: Cart
  - name: Orders
  - name: Customers
  - name: Loyalty

paths:
  /catalogs:
    get:
      tags: [Catalog]
      summary: List catalogs
      operationId: listCatalogs
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Catalog'

  /products:
    get:
      tags: [Products]
      summary: List products
      operationId: listProducts
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'

  /products/{productId}:
    get:
      tags: [Products]
      summary: Get product detail
      operationId: getProduct
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'

  /inventory/{productId}:
    get:
      tags: [Inventory]
      summary: Get inventory status
      operationId: getInventory
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Inventory'

  /cart:
    post:
      tags: [Cart]
      summary: Add item to cart
      operationId: addToCart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CartItem'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'

  /orders:
    post:
      tags: [Orders]
      summary: Create order from cart
      operationId: createOrder
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'

  /customers/{customerId}:
    get:
      tags: [Customers]
      summary: Get customer profile
      operationId: getCustomer
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Customer'

  /loyalty/{customerId}:
    get:
      tags: [Loyalty]
      summary: Get loyalty points
      operationId: getLoyalty
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoyaltyAccount'

  /admin/orders:
    get:
      tags: [Orders]
      summary: List orders (admin)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'

  /admin/orders/{orderId}/status:
    patch:
      tags: [Orders]
      summary: Advance order status (admin)
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK

  /admin/inventory/{productId}/adjust:
    patch:
      tags: [Inventory]
      summary: Adjust inventory manually (admin)
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [quantity]
              properties:
                quantity:
                  type: integer
      responses:
        '200':
          description: OK

  /admin/products/{id}/price:
    patch:
      tags: [Products]
      summary: Change product base price
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [price]
              properties:
                price:
                  type: number
                  format: double
      responses:
        '200':
          description: Product updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Product not found

  /admin/catalogs/{id}/activate:
    patch:
      tags: [Catalog]
      summary: Activate catalog
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Catalog activated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Catalog'
        '404':
          description: Catalog not found

  /admin/loyalty/{customerId}/adjust:
    patch:
      tags: [Loyalty]
      summary: Adjust loyalty points manually
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [points]
              properties:
                points:
                  type: integer
      responses:
        '200':
          description: Loyalty updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoyaltyAccount'


components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Catalog:
      type: object
      required: [id, name, active]
      properties:
        id:
          type: string
        name:
          type: string
        active:
          type: boolean

    Product:
      type: object
      required: [id, name, basePrice, active, catalogId]
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        basePrice:
          type: number
          format: double
        active:
          type: boolean
        catalogId:
          type: string

    Inventory:
      type: object
      required: [productId, availableQuantity, reservedQuantity]
      properties:
        productId:
          type: string
        availableQuantity:
          type: integer
          minimum: 0
        reservedQuantity:
          type: integer
          minimum: 0

    Customer:
      type: object
      required: [id, name, email]
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
          format: email
        address:
          type: string

    Cart:
      type: object
      required: [id, customerId, status, items]
      properties:
        id:
          type: string
        customerId:
          type: string
        status:
          type: string
          enum: [ACTIVE, CHECKED_OUT]
        items:
          type: array
          items:
            $ref: '#/components/schemas/CartItem'

    CartItem:
      type: object
      required: [productId, quantity, unitbasePrice]
      properties:
        productId:
          type: string
        quantity:
          type: integer
          minimum: 1
        unitbasePrice:
          type: number
          format: double

    Order:
      type: object
      required: [id, customerId, status, total, items, createdAt]
      properties:
        id:
          type: string
        customerId:
          type: string
        status:
          type: string
          enum: [PAID, PREPARING, READY, DELIVERED]
        total:
          type: number
          format: double
        createdAt:
          type: string
          format: date-time
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'

    OrderItem:
      type: object
      required: [productId, quantity, unitbasePrice]
      properties:
        productId:
          type: string
        quantity:
          type: integer
        unitbasePrice:
          type: number
          format: double

    LoyaltyAccount:
      type: object
      required: [customerId, points]
      properties:
        customerId:
          type: string
        points:
          type: integer
          minimum: 0

security:
  - bearerAuth: []